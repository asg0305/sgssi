# Node pentesting

# Uso de librerías vulnerables
Una de las formas más comunes de atacar una aplicación web es a través de las librerías que utiliza. Si una librería tiene una vulnerabilidad, un atacante puede aprovecharse de ella para atacar la aplicación.  
En las aplicaciones hechas con Node.js es muy común utilizar librerías de terceros. Para gestionar estas librerías, se utiliza npm, que es el gestor de paquetes de Node.js.  
Muchas veces, confiamos en las librerías y no nos preocupamos de si tienen vulnerabilidades o no. Sin embargo, es importante tener en cuenta que las librerías que utilizamos pueden tener vulnerabilidades y que es importante mantenerlas actualizadas.
- ¿Con qué comando podemos ver las vulnerabilidades conocidas de nuestras dependencias?
- ¿Cómo podemos actualizar las dependencias de nuestra aplicación?
- En la página de 'Memos', el input del usuario se convierte a Markdown. La librería que se utiliza para esto es `marked`. Sabiendo esto, encuentra el reporte correspondiente mediante el comando que has utilizado antes.
- Explota la vulnerabilidad de esta librería.  
>[!TIP]  
>El servidor tiene cierta protección y filtra los caracteres peligrosos como ':' y ')' y también su codificación HTML con nombre, pero no filtra las entidades numéricas.  
>[Pista](https://onlinetools.com/ascii/convert-ascii-to-html-entities)  

- Como ejercicio **opcional**, explota otras librerías vulnerables que encuentres en el repositorio.

# ReDoS
Cuando pensamos en ataques de denegación de servico (DoS) solemos pensar en masas de bots atacando un servidor. Sin embargo, hay otro tipo de DoS que es mucho más sutil: el ReDoS (Regular Expression Denial of Service).
Este ataque se basa en el funcionamiento de las validaciones Regex, que son muy utilizadas para validar el input del usuario en los formularios, para verificar que la cadena que ha introducido el usuario es un email, por ejemplo.

Cuando un sistema valida una cadena con una expresión regular, lo que hace es intentar hacer match con la cadena que le hemos pasado. Si la cadena es muy larga y la expresión regular es muy compleja, el sistema puede tardar mucho tiempo en calcular un resultado dado el número de cálculos que tiene que hacer.  
Si al desarrollar la web se han seguido buenas prácticas, el sistema debería validar el input del usuario tanto en el frontend como en el backend.  
Si introducimos una cadena para provocar un ReDoS mediante el frontend, solamente se bloqueará nuestro navegador ya que la validación se suele realizar primero en el cliente. Sin embargo, si introducimos una cadena para provocar un ReDoS enviándola directamente al backend (mediante Postman, Burpsuite...), el servidor se bloqueará y no podrá atender a más peticiones.
- En el campo Bank Routing de la página profile, genera un ReDoS sabiendo que es un campo que debe tener números y '#' al final.
- Cuando lo hayas conseguido, intenta entrar a la página desde otra pestaña.
- Cuando hayas conseguido bloquear el servidor, cancela la carga de la página y pulsa 'No' cuando te pregunte si quieres volver a enviar el formulario.
- ¿Cuál es el patrón problemático? ¿Por qué?
- ¿Cómo arreglarías este problema?

Si quieres saber más sobre Regex y ReDoS, puedes leer [este artículo](https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS).

>[!NOTE]  
>Aunque lo divertido de esto es buscar y encontrar las vulnerabilidades por tu cuenta, si te atascas, siempre puedes acceder a la página `/tutorial` de NodeGoat para resolver los ejercicios.
